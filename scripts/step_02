#!/bin/bash

# Step 2: Scrape BoardGameGeek for publisher information
# This script handles virtual environment activation and runs the Python script

set -e  # Exit on any error

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR/.."

echo "üé≤ Essen Route Planning - Step 2: Scrape BGG"
echo "==========================================="

# Check if virtual environment exists
if [ ! -d "venv" ]; then
    echo "‚ùå Error: Virtual environment not found!"
    echo "   Please run: python3 -m venv venv"
    echo "   Then: source venv/bin/activate && pip install -r requirements.txt"
    exit 1
fi

# Check if collection.csv exists (unified enricher needs it)
if [ ! -f "collection.csv" ]; then
    echo "‚ùå Error: collection.csv not found!"
    echo "   Please download your BGG collection first."
    echo "   Run ./step_01 for instructions"
    exit 1
fi

# Activate virtual environment and run the script
echo "üêç Activating virtual environment..."
source venv/bin/activate

echo "‚ö†Ô∏è  Note: This step enriches ALL games in your collection"
echo "   ‚Ä¢ BGG scraping uses human-like delays (1-3 seconds between requests)"
echo "   ‚Ä¢ Enriches both owned games (for tag search) and target games (for Essen route)"
echo "   ‚Ä¢ BGG pages cached in data/cache/bgg/, JSON results in data/cache/"
echo ""
echo "‚ñ∂Ô∏è  Running step 2..."
echo "   Usage: ./step_02 [--no-cache] [--include-expansions]"
python src/steps/step2_scrape_bgg_unified.py "$@"

echo ""
echo "‚úÖ Step 2 complete!"
echo "   Next: Run ./step_03 to fetch Essen exhibitor data"