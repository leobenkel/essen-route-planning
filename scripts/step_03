#!/bin/bash

# Step 3: Fetch Essen Spiel exhibitor and product data
# This script handles virtual environment activation and runs the Python script

set -e  # Exit on any error

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR/.."

echo "üé≤ Essen Route Planning - Step 3: Fetch Essen Data"
echo "==============================================="

# Check if virtual environment exists
if [ ! -d "venv" ]; then
    echo "‚ùå Error: Virtual environment not found!"
    echo "   Please run: python3 -m venv venv"
    echo "   Then: source venv/bin/activate && pip install -r requirements.txt"
    exit 1
fi

# Check if step 2 output exists
if [ ! -f "data/output/enriched_games.json" ]; then
    echo "‚ùå Error: enriched_games.json not found!"
    echo "   Please run ./step_02 first"
    exit 1
fi

# Activate virtual environment and run the script
echo "üêç Activating virtual environment..."
source venv/bin/activate

current_year=$(date +%Y)
echo "üåê Fetching Essen Spiel $current_year data..."
echo "   Usage: ./step_03 [--no-cache]"
echo "‚ñ∂Ô∏è  Running step 3..."
python src/steps/step3_fetch_essen_data.py "$@"

echo ""
echo "‚úÖ Step 3 complete!"
echo "   Next: Run ./step_04 to match publishers to exhibitors"